var _paq = _paq || [];
var global_config = new Object();
const CORE_URL = "http://"; //需要在此处配置游戏URL
var isWechat = false;
var scriptWechat;
var isWechatScriptloadDone = false;
var ua = navigator.userAgent.toLowerCase();
if (ua.match(/MicroMessenger/i) == "micromessenger") {
    isWechat = true;
    scriptWechat = document.createElement("script");
    scriptWechat.src = "http://res.wx.qq.com/open/js/jweixin-1.0.0.js";
    scriptWechat.type = "text/javascript";
    scriptWechat.async = "true";
    var domel = document.getElementsByTagName("script")[0];
    domel.parentNode.insertBefore(scriptWechat, domel);
    scriptWechat.onload = function () {
        isWechatScriptloadDone = true
    }
}
function init_config(a) {
    console.log("init data");
    console.log(a.wechat_sign);
    if (null == a || undefined == a) {
        return
    }
    global_config = a;
    if (isWechat) {
        if (!isWechatScriptloadDone) {
            scriptWechat.onload = function () {
                wechat_invoke(global_config.wechat_sign)
            }
        } else {
            wechat_invoke(global_config.wechat_sign)
        }
    }
}
function wechat_invoke(a) {
    jssdkconfig = JSON.parse(a) || {};
    jssdkconfig.debug = false;
    jssdkconfig.jsApiList = ["checkJsApi", "onMenuShareTimeline", "onMenuShareAppMessage", "onMenuShareQQ", "onMenuShareWeibo", "hideMenuItems", "showMenuItems", "hideAllNonBaseMenuItem", "showAllNonBaseMenuItem", "translateVoice", "startRecord", "stopRecord", "onRecordEnd", "playVoice", "pauseVoice", "stopVoice", "uploadVoice", "downloadVoice", "chooseImage", "previewImage", "uploadImage", "downloadImage", "getNetworkType", "openLocation", "getLocation", "hideOptionMenu", "showOptionMenu", "closeWindow", "scanQRCode", "chooseWXPay", "openProductSpecificView", "addCard", "chooseCard", "openCard"];
    wx.config(jssdkconfig);
    var c = document.title;
    var b = $('meta[name="x-share-desc"]').attr("content");
    invokeMsg(c, b)
}
function invokeMsg(d, c) {
    if (!isWechat) {
        return
    }
    var b = getShareURL();
    var a = {
        title: d,
        desc: c,
        link: b,
        imgUrl: CORE_URL + $('meta[name="x-share-icon"]').attr("content"),
        trigger: function (e) {
        },
        success: function (e) {
            _paq.push(["trackGoal", 6]);
            window.location = global_config.cta_url
        },
        cancel: function (e) {
            window.location = global_config.cta_url
        },
        fail: function (e) {
            alert("网络问题，请您稍后分享")
        }
    };
    wx.ready(function () {
        wx.onMenuShareTimeline(a);
        wx.onMenuShareAppMessage(a);
        wx.onMenuShareQQ(a);
        wx.onMenuShareWeibo(a)
    });
    wx.error(function (e) {
    })
}
function hdAppFreeWashShareData() {
    return '{"id":"","thumb":"' + $('meta[name="x-share-icon"]').attr("content") + '","name":"' + document.title + '","desc":"' + $('meta[name="x-share-desc"]').attr("content") + '","app_link":"' + getShareURL() + '"}'
}
function resetShareText(d) {
    console.log("reset level:" + d);
    var c = document.title;
    var a = $('meta[name="x-share-desc"]').attr("data-custom");
    c = a.replace("{l}", d);
    var b = $('meta[name="x-share-desc"]').attr("content");
    invokeMsg(c, b)
}
function resetShareTextByTitle() {
    var b = document.title;
    var a = $('meta[name="x-share-desc"]').attr("content");
    invokeMsg(b, a)
}
function resetShareTextByText(b) {
    var c = b;
    var a = $('meta[name="x-share-desc"]').attr("content");
    invokeMsg(c, a)
}
function resetShareTextByTextDesc(c, b) {
    var d = c;
    var a = b;
    invokeMsg(d, a)
}
function getShareCallBackURL() {
    var a = $('meta[name="x-share-callback"]').attr("content");
    if (a == undefined || a == "") {
        a = global_config.default_url
    }
    return a
}
function getQueryString(a) {
    var b = new RegExp("(^|&)" + a + "=([^&]*)(&|$)", "i");
    var c = window.location.search.substr(1).match(b);
    if (c != null) {
        return unescape(c[2])
    }
    return 0
}
function getCookie(a) {
    if (document.cookie.length > 0) {
        c_start = document.cookie.indexOf(a + "=");
        if (c_start != -1) {
            c_start = c_start + a.length + 1;
            c_end = document.cookie.indexOf(";", c_start);
            if (c_end == -1) {
                c_end = document.cookie.length
            }
            return unescape(document.cookie.substring(c_start, c_end))
        }
    }
    return ""
}
function setCookie(b, c, a) {
    var d = new Date();
    d.setDate(d.getDate() + a);
    document.cookie = b + "=" + escape(c) + ((a == null) ? "" : ";expires=" + d.toGMTString())
}
function getTPCode() {
    pt_code = getCookie("pt_code");
    if (pt_code == null || pt_code == "" || pt_code == undefined) {
        pt_code = randomString(16);
        setCookie("pt_code", pt_code, 365)
    }
    return pt_code
}
function randomString(c) {
    var b = "0123456789abcdefghiklmnopqrstuvwxyz".split("");
    if (!c) {
        c = Math.floor(Math.random() * b.length)
    }
    var d = "";
    for (var a = 0; a < c; a++) {
        d += b[Math.floor(Math.random() * b.length)]
    }
    return d
}
function getShareURL() {
    var a = global_config.share_url;
    if (a == null || a == undefined) {
        return window.location.href
    }
    if (a.indexOf("#") > 1) {
        a = a.substr(0, a.indexOf("#"))
    }
    if (a.indexOf("?pt_code") > 1) {
        a = a.replace(/pt_code=[0-9a-z]{16}&/g, "");
        a = a.replace(/pt_code=[0-9a-z]{16}/g, "")
    } else {
        a = a.replace(/&pt_code=[0-9a-z]{16}/g, "")
    }
    if (a.indexOf("?") > 0 && a.indexOf("?") == a.length - 1) {
        a += "pt_code=" + getTPCode()
    } else {
        if (a.indexOf("?") > 0) {
            a += "&pt_code=" + getTPCode()
        } else {
            a += "?pt_code=" + getTPCode()
        }
    }
    return a
}
function getTPCodeFromURL() {
    var b = /pt_code=([0-9a-z]{16})/i;
    pt_code = "";
    try {
        pt_code = b.exec(window.location.href)[1];
        if (pt_code == undefined || pt_code.length != 16) {
            return ""
        }
    } catch (a) {
        console.log(a.message)
    }
    return pt_code
}
function goHome() {
    var a = window.location.origin + "/" + window.location.search;
    window.location = a
}
function orientationChange() {
    switch (window.orientation) {
        case 0:
            $("body").css("transform", "");
            break;
        case -90:
            alert("游戏要竖屏玩哟！！！");
            break;
        case 90:
            alert("游戏要竖屏玩哟！！！");
            break;
        case 180:
            break
    }
}
var pt_from = getTPCodeFromURL();
if (pt_from != undefined) {
    _paq.push(["setCustomVariable", 1, "PathTracking_From", pt_from, "visit"])
}
var pt_current = getTPCode();
if (pt_current != undefined) {
    _paq.push(["setCustomVariable", 2, "PathTracking_Current", pt_current, "visit"])
}
//document.write('<script src="' + CORE_URL + "common/config/?site=" + getQueryString("site") + '"><\/script>');